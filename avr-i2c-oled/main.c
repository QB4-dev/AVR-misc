#include <avr/io.h>
#include <util/delay.h>
#include <avr/pgmspace.h>
#include <u8g2.h>
#include <u8x8-avr-LLdrv/u8x8_avr.h>
#include <u8x8_xprintf.h>

#define SSD1306_ADDR  0x78

#define lenny_width 71
#define lenny_height 32
static const unsigned char lenny_bits[] PROGMEM = {
	   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0,
	   0x0f, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x80, 0x00, 0xfc, 0x38, 0xc0, 0x00,
	   0xe0, 0xc7, 0x03, 0xc0, 0x00, 0xfe, 0x40, 0xc0, 0x00, 0xf0, 0x8f, 0x07,
	   0xc0, 0x00, 0x8d, 0x81, 0xe0, 0x00, 0x68, 0x0c, 0x0f, 0xe0, 0x00, 0x84,
	   0x01, 0xe0, 0x00, 0x60, 0x08, 0x03, 0x60, 0x00, 0x8c, 0x01, 0xc0, 0x00,
	   0x40, 0x0c, 0x07, 0x60, 0x00, 0xf8, 0x00, 0xe0, 0x03, 0xc0, 0x0e, 0x06,
	   0x70, 0x00, 0x70, 0x00, 0xc0, 0x07, 0x80, 0x03, 0x06, 0x70, 0x00, 0x00,
	   0x00, 0x00, 0x0f, 0x00, 0x00, 0x0e, 0x70, 0x00, 0x00, 0x00, 0x00, 0x0e,
	   0x00, 0x00, 0x0e, 0x30, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x0e,
	   0x70, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x0e, 0x30, 0x00, 0x00,
	   0x00, 0x00, 0x0c, 0x00, 0x00, 0x0e, 0x70, 0x00, 0x00, 0x00, 0x00, 0x0e,
	   0x00, 0x00, 0x0e, 0x70, 0x00, 0x00, 0x00, 0x18, 0x0e, 0x00, 0x00, 0x0e,
	   0x70, 0x00, 0x00, 0x00, 0x1c, 0x0f, 0x00, 0x00, 0x06, 0x70, 0x00, 0x00,
	   0x00, 0xf8, 0x07, 0x00, 0x00, 0x06, 0x60, 0x00, 0x00, 0x00, 0xf0, 0x01,
	   0x00, 0x00, 0x07, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07,
	   0xc0, 0x00, 0x00, 0x00, 0x01, 0x80, 0x00, 0x00, 0x03, 0xc0, 0x00, 0x00,
	   0x00, 0x06, 0x60, 0x00, 0x00, 0x03, 0x80, 0x01, 0x00, 0x00, 0xbc, 0x3e,
	   0x00, 0x80, 0x01, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x02, 0x00, 0x00, 0x00,
	   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


u8g2_t u8g2;

int main (void)
{
	u8g2_Setup_ssd1306_i2c_128x32_univision_f(&u8g2, U8G2_R0, u8x8_byte_avr_hw_i2c, u8x8_avr_delay);
	u8g2_SetI2CAddress(&u8g2, SSD1306_ADDR);
	u8g2_InitDisplay(&u8g2);
	u8g2_SetPowerSave(&u8g2, 0);
	uint8_t x =0;

	u8g2_ClearBuffer(&u8g2);
	u8g2_DrawXBMP(&u8g2,25,0, lenny_width, lenny_height, lenny_bits);
	u8g2_SendBuffer(&u8g2);
	_delay_ms(3000);


	while(1){
		u8g2_ClearBuffer(&u8g2);
		u8g2_SetFont(&u8g2, u8g2_font_smart_patrol_nbp_tr);
		u8g2_SetFontDirection(&u8g2, 0);
		u8g2_SetFontRefHeightText(&u8g2);
		u8g2_SetFontPosTop(&u8g2);
		u8g2_DrawStr(&u8g2, 0, 0, "u8g2 AVR HW I2C");

		u8g2_SetFont(&u8g2, u8g2_font_5x8_tf);
		XPRINTF(&u8g2,0,12,PSTR("xprintf test: dec %d"), x);
		XPRINTF(&u8g2,0,22,PSTR("hex %X lz %02d str %s"), x, x%10, "hello");
		u8g2_SetFontDirection(&u8g2, 1);
		XPUTS(&u8g2,120,15,PSTR("HEY"));
		u8g2_SendBuffer(&u8g2);

		_delay_ms(100);
		x++;
	}
}

